---
title: 计算机网络详解
date: 2020-05-18 15:18:24
permalink: /pages/1c11c0/
categories:
  - 个人博客
  - 其他
tags:
  - 网络
---

## 前言

本文章是在学习计算机网络的过程中总结加笔记结合，对计算机网络课程知识点作了全面的梳理，不免也有很多浅层的认识和冗余的记录，但是也肯定会对你全面复习计算机网络有一定的帮助！对于文中理解不对的地方，大家多多指正，一起学习哇！

> 推荐使用电脑浏览，文中引用如有不当之处，请联系删除！

## 一、计算机网络概览

### 1.1 计算机网络基础

- 最简单的定义：计算机网络是一些互相连接的、自治的计算机的集合
- 计算机网络分类：
  - 作用范围：广域网（WAN）、城域网（MAN）、局域网（LAN）、个人区域网（PAN）
  - 使用者：公用网、专用网

### 1.2 网络交换技术

- “交换”源于电话网络，含义是通过交换机进行转接，把一条电话线接到另一条电话线，使他们连通起来。
- 从通信资源的分配角度，“交换”就是按照某种方式**动态分配**传输路线的资源。
- 三种交换技术：电路交换、报文交换、分组交换 （传输模型图如下）
  ![](https://user-gold-cdn.xitu.io/2020/2/24/17075cd4ffc05666?w=864&h=470&f=png&s=204124)

### 1.3 计算机网络体系结构

- 分别有三种协议体系
  ![](https://user-gold-cdn.xitu.io/2020/2/24/17075d044516e11a?w=871&h=465&f=png&s=173844)
- 分层——西方科学的脊髓
  - 化繁为简，化大为小
  - 区分宏观和微观：不同层次的问题
  - 区分“实体”的视角
- 分层的优点：各层之间独立、灵活性好、结构上可分割、易于实现和维护、能促进标准化工作
- 模型四要素：分层 - 实体 - 服务 - 协议
- 计算机网络的体系结构是**计算机网络各层及其协议的集合**
- 层次模式的核心：实体、协议和服务
- 实际应用当中法律上的国际标准 OSI 体系并没有得到市场认可，主要用于学术研究，而非国际标准的 TCP/IP 现在获得了最广泛地应用。
- OSI 七层协议各层功能（借鉴人类沟通原理）

| 名称       | 英文名             | 主要功能简介                                                                                                                                                                                                                     |
| ---------- | ------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 应用层     | Application Layer  | 作为与用户应用进程的接口，**负责用户信息的语义表示，并在两个通信者之间进行语义匹配**，它不仅要提供应用进程所需要的信息交换和远地操作，而且还要作为互相作用的应用进程的用户代理来完成一些为进行语义上有意义的信息交换所必需的功能 |
| 表示层     | Presentation Layer | 对源站点内部的数据结构进行编码，形成适合于传输的比特流，到了目的站再进行解码，转换成用户所要求的格式并保持数据的意义不变，**主要用于数据格式转换**                                                                               |
| 会话层     | Session Layer      | 提供一个面向用户的连接服务，他给合作的绘画用户直接的对话活动提供组织和同步所必需的手段，以便对数据的传送提供控制和管理，**主要用于会话的管理和数据传输的同步**                                                                   |
| 传输层     | Transport Layer    | 从端到端经网络透明地传输报文，完成**端到端通信链路的建立、维护和管理**                                                                                                                                                           |
| 网络层     | Network Layer      | 分组传送、路由选择和流量控制，主要用于实现**端到端通信系统中中间节点的路由选择**                                                                                                                                                 |
| 数据链路层 | Data Link Layer    | 通过一些数据链路层协议和链路控制规程，**在不太可靠的物理链路上实现可靠的数据传输**                                                                                                                                               |
| 物理层     | Physical Layer     | 实现**相邻计算机节点之间比特数据流的透明传送**，尽可能屏蔽掉具体传输介质和物理设备的差异                                                                                                                                         |

- TCP/IP 的体系结构示意图

  <img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfcrxpgp6oj30ze0l2h7e.jpg" style="zoom:50%;" />

- 沙漏计时器形状的 TCP/IP 协议簇
  <img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfcrya54c9j310i0nmkcf.jpg" style="zoom:50%;" />

* **OSI** VS **TCP/IP** 两种体系比较
  - OSI 七层协议体系结构既复杂又不实用，但是概念清除，体系价格低廉，理论比较完整。其中会话层和表示层作用不大
  - TCP/IP 的协议现在得到全世界的承认，但是并没有一个完整的体系结构。TCP/IP 是一个四层的体系结构，包含**应用层、运输层、网际层和网络接口层**
  - 由于最下面的网络接口层没什么具体的内容，所以从实质上讲，**TCP/IP 只有三层，既应用层、运输层和网际层**

### 1.4 计算机网络的性能

#### 1）计算机网络的性能指标——**速率**

- 计算机中数据量单位**比特（bit）**.Bit 来源于 binary digit，意为“二进制数字”，因此一个比特就是一个二进制数字中的一个 1 或 0
- **速率**既**数据率**或**比特率**。速率的单位 b/s, kb/s, Mb/s, Gb/s...

  - 主要性能指标——**带宽**

  “带宽”本来是指信号具有的频带宽度，单位是赫（或千赫、兆赫、吉赫）。现在“带宽”是数字信道所能传送的“最高数据率”的同意语，单位是“比特每秒”，或 b/s.

#### 2）计算机网络的性能指标——**吞吐量**

- 吞吐量表示在单位时间内通过某个网络（或信道、接口）的数据量
- 吞吐量受网络的带宽或网络的额定速率的限制
- 主要性能指标——**时延**
  - 分别包括：发送时延、传播时延、处理时延、排队时延
  - 发送时延=数据块长度（比特）/信道带宽（比特/秒）
  - 传播时延=信道长度（米）/信号在信道上的传播速率（米/秒）
  - 产生时延的地方：在队列中产生处理时延、排队时延；在发送器产生发送时延；在链路上产生传播时延
  - 时延带宽积 = 传播时延 X 带宽
- **利用率**
  - **信道利用率**指有百分之几的时间是被利用的（有数据通过）。完全空闲的信道的利用率是零 **（信道利用率并非越高越好）**
  - **网络利用率**则是全网络的信道利用率的加权平均值
- 时延与网络利用率的关系：
  - 当某信道的利用率增大时，该信道引起的时延也就迅速增加（排队论）
  - **网络当前时延（D） = 网络空闲时的时延（D0） / （1 - 网络利用率 U）**

<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfcrv90g5uj30py0eg0tx.jpg" alt="image-20200601142835581" style="zoom:40%;" />

---

## 二、物理层详解

### 2.1 数据通信基础知识

- 数据通信系统模型

<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfcrv1mjdoj31cw0oewwm.jpg" alt="image-20200601142822955" style="zoom:50%;" />

- 数据：运送消息的实体
- 信号：数据的电气或电磁的表现
- 码元：在使用时间域（或简称为时域）的波形表示数字信号时，代表不同离散数值的基本波形
- 信号发送
  - 模拟信号发送
  - 数字信号发送：
    - 优点：价格便宜，对噪声不敏感；
    - 缺点：易受衰减，频率越高，衰减越厉害。
- 编码与调制
- 信道基本概念
  - 单工通信方式: 信息只能单向传输，监视信号可回送。
  - 半双工通信方式: 信息可以双向传输，但在某一时刻只能单向传输。
  - 全双工通信方式: 信息可以同时双向传输，一般采用四线式结构。
- 基带信号和带通信号
  - 基带信号：将来自信源的数字信号 1 或 0 直接用两种不同的电压来表示，送到 线路上传输
  - 带通信号：将基带信号进行载波调制后，把信号的频率范围搬移到较高的频 段以便在信道中传输。 在一条电缆中同时传送多路数字信号

基带信号往往包含有较多的低频成分，甚至有直流成分，而 许多信道并不能传输这种低频分量或直流分量。为了解决这 一问题，就必须对基带信号进行编码（coding）和调制。

编码后的信号——仍是基带信号

带通调制后的信号——带通信号

- 常用编码方式
  - 不归零制：正电平代表 1，负电平代表 0。
  - 归零制：正脉冲代表 1，负脉冲代表 0。
  - 曼彻斯特编码：**位周期中心的上跳变代表 0，位周期中心的下跳变代表 1**。也可反过来定义。
  - 差分曼彻斯特编码：在每位的**中心处始终都有跳变**。位开始边界有跳变代表 0，位开始边界没有跳变代表 1。

![image-20200601142803241](https://tva1.sinaimg.cn/large/007S8ZIlgy1gfcruotcmtj317o0m8jtr.jpg)

- 带通调制方法
  - 基本带通调制方法
    - 调幅（AM）：载波的**振幅**随基带数字信号而变化
    - 调频（FM）：载波的**频率**随基带数字信号而变化
    - 调相（PM）：载波的**初始相位**随基带数字信号而变化
  - 多元制振幅相位混合调制方法
    - 正交振幅调制 QAM

<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfcrtr7b5aj31am0n4k7r.jpg" alt="image-20200601142709081" style="zoom:50%;" />

为了达到更高的信息传输速率，必须采用多元制的振幅和相位混合调制方法。

- 信道极限容量

  - 任何实际的信道都不是理想的，在传输信号时会产生各种失真以及带来多种干扰
  - 码元传输的**速率越高，或信号传输的距离越远**，在信道的输出端的波形的失真就越严重。

- 信道能够通过的频率范围

在假定的理想条件下，为了避免码间串扰，码元的传 输速率的上限值：

```
波特率 = 2  W （Baud）
- W是理想信道的带宽，单位为赫(Hz)；
- 码元传输速率的单位是Baud（波特），码元/秒。
```

在假定的理想条件下，信息传输速率的上限值：

```
比特率 = 2  W log2 L （b/s）
- L为信号电平数量
- 数据传输速率的单位是b/s（比特/秒）
```

- 信噪比

香农(Shannon)用信息论的理论推导出了**带宽受限且有高斯白噪声干扰的信道的极限、无差 错的信息传输速率**

```
  C = W log2(1+ S / N )  b/s
  - W 为信道的带宽（以 Hz 为单位）；
  - S 为信道内所传信号的平均功率；
  - N 为信道内部的高斯噪声功率。
```

对于频带宽度已确定的信道，如果信噪比不能 再提高了，并且码元传输速率也达到了上限值 ，那么还有办法提高信息的传输速率。这就是 用编码的方法让每一个码元携带更多比特的信 息量。

### 2.2 物理层下面的传输媒体

- 常见传输媒体

| 传输介质 | 频带范围                                   | 带宽      | 传输距离                              |
| -------- | ------------------------------------------ | --------- | ------------------------------------- |
| 双绞线   | 0-100MHz                                   | 100MHz    | 15 公里或更大 局域网 10/100Mbps100 米 |
| 同轴电缆 | 100KHz-500MHz                              | 400MHz    | 几公里-几十公里                       |
| 无线     | 10KHz-900MHz                               | 900MHz    | 几十公里                              |
| 微波     | 300MHz-300GHz                              |           | 视距范围                              |
| 卫星     | 300MHz-30GHz KU:12GHz-18GHz KA:20GHz-30GHz |           | 一个同步卫星可以覆盖地球 1/3 上的表面 |
| 光波     | 10^14-10^15Hz                              | 30 亿 MHz | 不加中继器 6-8 公里                   |

- 引导型传输媒体：双绞线、同轴电缆、光缆
- 非引导型传输媒体：无线传输、卫星、微波

### 2.3 信道复用技术

- 三种复用方式：频分复用、时分复用和统计时分复用
- 频分复用 FDM
  - 用户在分配到一定的频带后，在通信过程中自始至终都占用 这个频带。
  - 频分复用的所有用户在同样的时间占用不同的带宽资源
- 时分复用 TDM
  - 时分复用则是将时间划分为一段段等长的时分复 用帧（TDM 帧）。每一个时分复用的用户在每一 个 TDM 帧中占用固定序号的时隙。
  - 每一个用户所占用的时隙是周期性地出现（其周 期就是 TDM 帧的长度）。
  - TDM 信号也称为等时(isochronous)信号
  - 时分复用的所有用户是在不同的时间占用同样的 频带宽度。

使用时分复用系统传送计算机数据时， 由于计算机数据的突发性质，用户对 分配到的子信道的利用率一般是不高的。

- 统计时分复用

  ![image-20200601142646234](https://tva1.sinaimg.cn/large/007S8ZIlgy1gfcrtda11uj318y0kkaij.jpg)

### 2.4 数字传输系统

脉码调制(Pulse Code Modulation,PCM)：数字信号是对 连续变化的模拟信号进行抽样、量化和编码产生的，称为 PCM。一路语音信号：64kbps

PCM 体制最初是为了在电话局之间的中继线上以时分多路 复用的方式传送多路电话。

由于历史上的原因，PCM 有两个互不兼容的国际标准，即 北美的 24 路 PCM（简称为 T1）和欧洲的 30 路 PCM（ 简称为 E1）。我国采用的是欧洲的 E1 标准。

E1 的速率是 2.048 Mb/s，而 T1 的速率是 1.544 Mb/s。

当需要有更高的数据率时，可采用复用的方法。

## 三、数据链路层基础

### 3.1 数据链路层概述

`链路(link)`是一条无源的`点到点`的**物理线路段**，中间没有任何其他的交换结点。一条链路只是一条通路的一个组成部分。

`数据链路(data link)` 除了物理线路外，还必须有`通信协议来控制`这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。

**数据链路信道**

- 点对点信道: 这种信道使用一对一的点对点通 信方式。
- 广播信道: 这种信道使用一对多的广播通信方式，因此过程比较复杂。广播信道上连接的主机很多，因此必须使用专用的共享信道协议来协调这些数据的发送。

> 数据链路层传输的是帧

常常在两个对等的数据链路层之间画出一个数 字管道，而在这条数字管道上传输的数据单位是**帧**.

**链路层三个基本问题**

- 封装成帧：在一段数据的前后分别添加首部和尾部，然后就构成了一个帧。确定帧的 界限。

![image-20200605170722446](https://tva1.sinaimg.cn/large/007S8ZIlgy1gfhixqngftj30ti0fuaaz.jpg)

- 透明传输

![image-20200606211113737](https://tva1.sinaimg.cn/large/007S8ZIlgy1gfivlr0inij30x80dygsz.jpg)

### 3.2 局域网的数据链路层

局域网最主要的特点是: 共享介质，网络为一个 单位所拥有，且地理范围和站点数目均有限。

局域网具有如下的一些主要优点:

- 使用广播信道，具有广播功能，从一个站点可很方便地访问全网。
- 便于系统的扩展和逐渐地演变，各设备的位置可灵活 调整和改变。
- 提高了系统的可靠性、可用性

<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfilswmssxj30pg0jmdn0.jpg" alt="局域网模型" style="zoom:67%;" />

为了使数据链路层能更好地适应多种局域网标准 ，802 委员会就将局域网的数据链路层拆成两个 子层:

- 逻辑链路控制 LLC (Logical Link Control)子层
- 媒体接入控制 MAC (Medium Access Control)子层

与接入到传输媒体有关的内容都放在 MAC 子层， 而 LLC 子层则与传输媒体无关，不管采用何种 协议的局域网对 LLC 子层来说都是透明的。

> 由于 TCP/IP 体系经常使用的局域网是 DIX Ethernet V2 而不是 802 标准中的几种局域 网，因此现在 802 委员会制定的逻辑链路控 制子层 LLC(即 802.2 标准)的作用已经不 大了。很多厂商生产的适配器上就仅装有 MAC 协议而没有 LLC 协议。

**适配器**

网络接口板又称为通信适配器(adapter)或 网络接口卡 NIC (Network Interface Card)，或“网卡”。

适配器的重要功能:

- 进行串行/并行转换。
- 对数据进行缓存。
- 在计算机的操作系统安装设备驱动程序。
- 实现以太网协议。

计算机通过适配器和局域网进行通信

![image-20200606153814547](https://tva1.sinaimg.cn/large/007S8ZIlgy1gfilza0p6uj30su0h80za.jpg)

### 3.3 以太网技术

**以太网 MAC 层的硬件地址**

- 在局域网中，硬件地址又称为物理地址，或 MAC 地址。

- 802 标准所说的“地址”严格地讲应当是每一个 站的“名字“或**标识符**

**适配器检查 MAC 地址**

适配器从网络上每收到一个 MAC 帧就首先用硬件检查 MAC 帧中的 MAC 地址.

- 如果是发往本站的帧则收下，然后再进行其他的处理。
- 否则就将此帧丢弃，不再进行其他的处理。

“发往本站的帧”包括以下三种帧:

- 单播(unicast)帧(一对一)
- 广播(broadcast)帧(一对全体)
- 多播（multicast)帧(一对多)

**MAC 帧的格式**

最常用的 MAC 帧是以太网 V2 的格式。

![image-20200606202214426](https://tva1.sinaimg.cn/large/007S8ZIlgy1gfiu6rx3f5j30xc0hitg5.jpg)

在帧的前面插入的 8 字节中的第一个字段共 7 个字节， 是前同步码，用来迅速实现 MAC 帧的比特同步。 第二个字段是帧开始定界符，表示后面的信息就是 MAC 帧。

类型字段用来标志上一层使用的是什么协议，以便把收到的 MAC 帧的数据上交给上一层的这个协议。

数据字段的正式名称是 MAC 客户数据字段 `最小长度 64 字节 - 18 字节的首部和尾部 = 数据字段的最小长度`

**无效的 MAC 帧**

- 帧的长度不是整数个字节;
- 用收到的帧检验序列 FCS 查出有差错;
- 数据字段的长度不在 46 ~ 1500 字节之间。
- 对于检查出的无效 MAC 帧就简单地丢弃。以太网不负责重传丢弃的帧。

**以太网通信**

- 采用较为灵活的无连接的工作方式，即不必先建立 连接就可以直接发送数据。
- 以太网对发送的数据帧不进行编号，也不要求对方 发回确认。这样做的理由是局域网信道的质量很好，因信道质量产 生差错的概率是很小的。
- 以太网发送的数据都使用曼彻斯特(Manchester)编码

**以太网提供的服务**

- 以太网提供的服务是不可靠的交付，即尽最大努 力的交付。

- 当目的站收到有差错的数据帧时就丢弃此帧，其 他什么也不做。差错的纠正由高层来决定。

- 如果高层发现丢失了一些数据而进行重传，但以 太网并不知道这是一个重传的帧，而是当作一个 新的数据帧来发送。

## 四、局域网组网技术

### 4.1 集线器连接的星型以太网

### 4.2 在物理层扩展局域网

### 4.3 在数据链路层扩展局域网

### 4.4 虚拟局域网(VLAN)

### 4.5 基于三层交换实现 LAN 之间互连互通

## 九、应用层概览

### 1.1 协议基本概念

> 应用层是体系结构中的**最高层**。
>
> 应用层确定进程之间通信的性质以满足用户的需要(这反映在用户所产生的服务请求)。
>
> 支持应用层协议有 HTTP、SMTP 和 FTP 等

**目标**

每个应用层协议都是为了解决某一类应用问题

**实施**

问题的解决又往往是通过位于不同主机中的多个应用进程之间的通信和协同工作来完成的。

应用层具体内容就是规定应用进程在通信时所遵循的协议。

**体系架构**

应用层的许多协议都是基于客户服务器方式

### 1.2 应用层协议小结

- 不是软件、不是进程、不解决业务需求。`为业务需求的实现提供通信`
- 应用进程实现网络通信需要实现的协议内容
- 面向应用需求的通信协议
- 需求类型有限 -- > 应用层协议有限

附一张协议层次图

![image-20200601142553879](https://tva1.sinaimg.cn/large/007S8ZIlgy1gfcrsg8lauj31f20meaie.jpg)

### 2.1 域名系统 DNS

**背景**

IP 地址原本为 32 位数字标识，而我们日常使用的时不可能去记忆 32 位的地址。因此我们使用了如`baidu.com`d 的现实世界的术语方式进行访问。

域名系统`DNS (Domain Name System)`实现名字到 IP 地址的解析。

> 网络规模较小时，主机直接查找指定文件就可以找出主机名字与 IP 地址的对应关系。但是网络规模扩大时，由于上述方法开销大、效率低、管理难的问题而采用了 DNS。

- 应用层软件经常直接使用域名系统 ，但计算机的用户只是间接而不是直接使用域名系统。

- 因特网采用层次结构的命名树作为主机的名字，并使 用分布式的域名系统 DNS。
- DNS 是一个联机**分布式数据库系统**，并采用客户/服务 器模式。
- 名字到 IP 地址的解析是由若干个域名服务器程序完 成的。域名服务器程序在专设的结点上运行，运行该 程序的机器称为域名服务器。

**工作过程**

1. 当应用程序需要解析域名时(从符号名到 IP 地址)，它成为域名系统的一个客户。
2. 它以 UDP 包格式向本地域名服务器发出解析请求，并将待解析的域 名放在请求报文中。
3. 本地域名服务器找到域名后，将对应的 IP 地址放在回答报文中返回， 应用进程获得目的主机的 IP 地址后即可进行通信。
4. 若本地域名服务器无法完成域名解析，它临时变成其上级域名服务 器的客户，并向其它域名服务器发出查询请求，递归解析，直到该域名 解析完成。

### 2.2 域名结构

```
... . 三级域名 . 二级域名 . 顶级域名
...mail.pku.edu.cn
```

![image-20200601142435789](https://tva1.sinaimg.cn/large/007S8ZIlgy1gfcrr3titlj31g60bwgxf.jpg)

- 国家顶级域名 :如:.cn 表示中国，.us 表示美国，.uk 表示英国，等等。
- `.com` 表示公司企业 `.net` 表示网络服务机构`.org`表示非赢利性组织`.edu` 表示教育机构(美国专用) `.gov`表示政府部门(美国专用)`.mil`表示军事部门(美国专用) `.int` (国际组织)

### 2.3 域名服务器

**根域名服务器**

根域名服务器是最重要的域名服务器。所有的 根域名服务器都知道所有的顶级域名服务器的 域名和 IP 地址。

不管是哪一个本地域名服务器，若要对因特网 上任何一个域名进行解析，只要自己无法解析 ，就首先求助于根域名服务器。

**顶级域名服务器**

这些域名服务器负责管理在该顶级域名服务器注 册的所有二级域名。

当收到 DNS 查询请求时，就给出相应的回答(可 能是最后的结果，也可能是下一步应当找的域名 服务器的 IP 地址)。

**权限域名服务器**

负责一个区的域名服务器。

**本地域名服务器**

### 2.4 域名解析过程

![image-20200601142506753](https://tva1.sinaimg.cn/large/007S8ZIlgy1gfcrrmvwraj31bl0u0dvo.jpg)

**名字的高速缓存**

- 每个域名服务器都维护一个高速缓存，存放最近用过的名 字以及从何处获得名字映射信息的记录。

- 当客户请求域名服务器转换名字时，查询此高速缓存。

- 可优化查询的开销，大大减轻根域名服务器的负荷，使因

特网上的 DNS 查询请求和回答报文的数量大为减少。

- 为保持高速缓存中的内容正确，域名服务器应为每项内容 设置计时器，并处理超过合理时间的项(例如，每个项目 只存放两天)。

  当权限域名服务器回答一个查询请求时，在响应中都指明 绑定有效存在的时间值。

### 3.1 电子邮件 Email

- Email 报文格式
- MIME 在其邮件首部中说明了邮件的数据类型( 如文本、声音、图像、视像等)，使用 MIME 可在邮件中同时传送多种类型的数据。
- 发送邮件的协议:SMTP
- 读取邮件的协议:POP3 和 IMAP

应用层协议数据单元：报文（message）

### 4.1 万维网

万维网是分布式超媒体(hypermedia)系统，它是超文本 (hypertext)系统的扩充。
